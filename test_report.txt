============================= test session starts =============================
platform win32 -- Python 3.12.2, pytest-8.1.1, pluggy-1.4.0 -- C:\Users\niksa\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\projects\diploma
plugins: anyio-4.6.2.post1, hydra-core-1.3.2, cov-4.1.0, docker-3.2.5
collecting ... collected 39 items

tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_success FAILED [  2%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_duplicate_login FAILED [  5%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_invalid_login_too_short PASSED [  7%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_invalid_login_too_long PASSED [ 10%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_invalid_password_too_short PASSED [ 12%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_invalid_surname_too_short PASSED [ 15%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_invalid_name_too_short PASSED [ 17%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_missing_required_fields PASSED [ 20%]
tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_without_patronymic FAILED [ 23%]
tests/services/auth/test_auth_endpoints.py::TestUserLogin::test_login_success FAILED [ 25%]
tests/services/auth/test_auth_endpoints.py::TestUserLogin::test_login_invalid_credentials PASSED [ 28%]
tests/services/auth/test_auth_endpoints.py::TestUserLogin::test_login_wrong_password PASSED [ 30%]
tests/services/auth/test_auth_endpoints.py::TestUserLogin::test_login_missing_fields PASSED [ 33%]
tests/services/auth/test_auth_endpoints.py::TestRefreshToken::test_refresh_success FAILED [ 35%]
tests/services/auth/test_auth_endpoints.py::TestRefreshToken::test_refresh_invalid_token PASSED [ 38%]
tests/services/auth/test_auth_endpoints.py::TestRefreshToken::test_refresh_missing_token PASSED [ 41%]
tests/services/auth/test_auth_endpoints.py::TestRefreshToken::test_refresh_revoked_token FAILED [ 43%]
tests/services/auth/test_auth_endpoints.py::TestLogout::test_logout_success FAILED [ 46%]
tests/services/auth/test_auth_endpoints.py::TestLogout::test_logout_without_token PASSED [ 48%]
tests/services/auth/test_auth_endpoints.py::TestLogout::test_logout_invalid_token PASSED [ 51%]
tests/services/auth/test_auth_endpoints.py::TestAdminLogin::test_admin_login_success FAILED [ 53%]
tests/services/auth/test_auth_endpoints.py::TestAdminLogin::test_admin_login_invalid_credentials PASSED [ 56%]
tests/services/auth/test_auth_endpoints.py::TestAdminLogin::test_admin_login_wrong_password PASSED [ 58%]
tests/services/auth/test_auth_endpoints.py::TestAdminLogin::test_admin_login_missing_fields PASSED [ 61%]
tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_success FAILED [ 64%]
tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_duplicate_login FAILED [ 66%]
tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_invalid_password_too_short FAILED [ 69%]
tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_missing_fields PASSED [ 71%]
tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_success FAILED [ 74%]
tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_admin_token FAILED [ 76%]
tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_without_token PASSED [ 79%]
tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_invalid_token PASSED [ 82%]
tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_refresh_token_rejected FAILED [ 84%]
tests/services/user/test_user_endpoints.py::TestUserProfile::test_get_me_success FAILED [ 87%]
tests/services/user/test_user_endpoints.py::TestUserProfile::test_update_me_success FAILED [ 89%]
tests/services/user/test_user_endpoints.py::TestUserProfile::test_update_status FAILED [ 92%]
tests/services/user/test_user_endpoints.py::TestUserSearch::test_search_users FAILED [ 94%]
tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users FAILED [ 97%]
tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users ERROR [ 97%]
tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users_forbidden FAILED [100%]
tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users_forbidden ERROR [100%]

=================================== ERRORS ====================================
______ ERROR at teardown of TestWorkspaceUsers.test_get_workspace_users _______

db_cursor = <cursor object at 0x0000016F63BBCAA0; closed: -1>

    @pytest.fixture
    def clean_workspace_data(db_cursor):
        """╬ўшёЄър фрээ√ї Ёрсюўшї яЁюёЄЁрэёЄт яюёых ЄхёЄр"""
        yield
        # ╬ўш∙рхь ЄрсышЎ√, ёт чрээ√х ё workspaces
        # ╧юЁ фюъ трцхэ шч-чр тэх°эшї ъы■ўхщ
>       db_cursor.execute('DELETE FROM "userInWorkspace"')

tests\services\user\conftest.py:65: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <cursor object at 0x0000016F63BBCAA0; closed: -1>
query = 'DELETE FROM "userInWorkspace"', vars = None

    def execute(self, query, vars=None):
        self.column_mapping = []
        self._query_executed = True
>       return super().execute(query, vars)
E       psycopg2.errors.UndefinedTable: relation "userInWorkspace" does not exist
E       LINE 1: DELETE FROM "userInWorkspace"
E                           ^

C:\Users\niksa\AppData\Local\Programs\Python\Python312\Lib\site-packages\psycopg2\extras.py:236: UndefinedTable
_ ERROR at teardown of TestWorkspaceUsers.test_get_workspace_users_forbidden __

db_cursor = <cursor object at 0x0000016F63BBD220; closed: -1>

    @pytest.fixture
    def clean_workspace_data(db_cursor):
        """╬ўшёЄър фрээ√ї Ёрсюўшї яЁюёЄЁрэёЄт яюёых ЄхёЄр"""
        yield
        # ╬ўш∙рхь ЄрсышЎ√, ёт чрээ√х ё workspaces
        # ╧юЁ фюъ трцхэ шч-чр тэх°эшї ъы■ўхщ
>       db_cursor.execute('DELETE FROM "userInWorkspace"')

tests\services\user\conftest.py:65: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <cursor object at 0x0000016F63BBD220; closed: -1>
query = 'DELETE FROM "userInWorkspace"', vars = None

    def execute(self, query, vars=None):
        self.column_mapping = []
        self._query_executed = True
>       return super().execute(query, vars)
E       psycopg2.errors.UndefinedTable: relation "userInWorkspace" does not exist
E       LINE 1: DELETE FROM "userInWorkspace"
E                           ^

C:\Users\niksa\AppData\Local\Programs\Python\Python312\Lib\site-packages\psycopg2\extras.py:236: UndefinedTable
================================== FAILURES ===================================
___________________ TestUserRegister.test_register_success ____________________

self = <tests.services.auth.test_auth_endpoints.TestUserRegister object at 0x0000016F60F6F200>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503706848@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}

    def test_register_success(self, base_url, api_path, valid_user_data):
        """╙ёях°эр  ЁхушёЄЁрЎш  яюы№чютрЄхы """
        url = f"{base_url}{api_path}/register"
        response = requests.post(url, json=valid_user_data)
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500]>.status_code

tests\services\auth\test_auth_endpoints.py:26: AssertionError
_______________ TestUserRegister.test_register_duplicate_login ________________

self = <tests.services.auth.test_auth_endpoints.TestUserRegister object at 0x0000016F60F892B0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503707134@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}

    def test_register_duplicate_login(self, base_url, api_path, valid_user_data):
        """╨хушёЄЁрЎш  ё єцх ёє∙хёЄтє■∙шь login фюыцэр тхЁэєЄ№ 409"""
        # ╤эрўрыр ЁхушёЄЁшЁєхь яюы№чютрЄхы 
        url = f"{base_url}{api_path}/register"
        first_response = requests.post(url, json=valid_user_data)
>       assert first_response.status_code == 201  # ╙схцфрхьё , ўЄю яхЁтр  ЁхушёЄЁрЎш  єёях°эр
E       assert 500 == 201
E        +  where 500 = <Response [500]>.status_code

tests\services\auth\test_auth_endpoints.py:39: AssertionError
______________ TestUserRegister.test_register_without_patronymic ______________

self = <tests.services.auth.test_auth_endpoints.TestUserRegister object at 0x0000016F63B49250>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
unique_timestamp = 1764503707390

    def test_register_without_patronymic(self, base_url, api_path, unique_timestamp):
        """╨хушёЄЁрЎш  схч юЄўхёЄтр фюыцэр с√Є№ єёях°эющ (юяЎшюэры№эюх яюых)"""
        data_without_patronymic = {
            "login": f"user{unique_timestamp}@example.com",
            "password": "SecurePassword123",
            "surname": "Ivanov",
            "name": "Ivan"
        }
        url = f"{base_url}{api_path}/register"
        response = requests.post(url, json=data_without_patronymic)
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500]>.status_code

tests\services\auth\test_auth_endpoints.py:124: AssertionError
______________________ TestUserLogin.test_login_success _______________________

self = <tests.services.auth.test_auth_endpoints.TestUserLogin object at 0x0000016F63B486E0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503707620@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503707620@example.com', 'password': 'SecurePassword123'}

    def test_login_success(self, base_url, api_path, valid_user_data, login_data):
        """╙ёях°э√щ тїюф яюы№чютрЄхы """
        # ╤эрўрыр ЁхушёЄЁшЁєхь яюы№чютрЄхы 
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        # ┬√яюыэ хь тїюф
        login_url = f"{base_url}{api_path}/login"
        response = requests.post(login_url, json=login_data)
    
>       assert response.status_code == 200
E       assert 401 == 200
E        +  where 401 = <Response [401]>.status_code

tests\services\auth\test_auth_endpoints.py:142: AssertionError
____________________ TestRefreshToken.test_refresh_success ____________________

self = <tests.services.auth.test_auth_endpoints.TestRefreshToken object at 0x0000016F63B493D0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503708069@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503708069@example.com', 'password': 'SecurePassword123'}

    def test_refresh_success(self, base_url, api_path, valid_user_data, login_data):
        """╙ёях°эюх юсэютыхэшх access Єюъхэр"""
        # ╨хушёЄЁшЁєхь ш тїюфшь
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        login_url = f"{base_url}{api_path}/login"
        login_response = requests.post(login_url, json=login_data)
>       refresh_token = login_response.json()["refresh_token"]
E       KeyError: 'refresh_token'

tests\services\auth\test_auth_endpoints.py:206: KeyError
_________________ TestRefreshToken.test_refresh_revoked_token _________________

self = <tests.services.auth.test_auth_endpoints.TestRefreshToken object at 0x0000016F63B49D60>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503708310@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503708310@example.com', 'password': 'SecurePassword123'}

    def test_refresh_revoked_token(self, base_url, api_path, valid_user_data, login_data):
        """╬сэютыхэшх ё юЄючтрээ√ь Єюъхэюь фюыцэю тхЁэєЄ№ 401"""
        # ╨хушёЄЁшЁєхь ш тїюфшь
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        login_url = f"{base_url}{api_path}/login"
        login_response = requests.post(login_url, json=login_data)
>       refresh_token = login_response.json()["refresh_token"]
E       KeyError: 'refresh_token'

tests\services\auth\test_auth_endpoints.py:247: KeyError
_______________________ TestLogout.test_logout_success ________________________

self = <tests.services.auth.test_auth_endpoints.TestLogout object at 0x0000016F63B49FD0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503708543@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503708543@example.com', 'password': 'SecurePassword123'}

    def test_logout_success(self, base_url, api_path, valid_user_data, login_data):
        """╙ёях°э√щ т√їюф шч ёшёЄхь√"""
        # ╨хушёЄЁшЁєхь ш тїюфшь
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        login_url = f"{base_url}{api_path}/login"
        login_response = requests.post(login_url, json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\auth\test_auth_endpoints.py:274: KeyError
___________________ TestAdminLogin.test_admin_login_success ___________________

self = <tests.services.auth.test_auth_endpoints.TestAdminLogin object at 0x0000016F63B4A540>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_admin_data = {'login': 'testadmin1764503708785@example.com', 'password': 'AdminSecurePassword123'}
admin_login_data = {'login': 'testadmin1764503708785@example.com', 'password': 'AdminSecurePassword123'}

    def test_admin_login_success(self, base_url, api_path, valid_admin_data, admin_login_data):
        """╙ёях°э√щ тїюф рфьшэшёЄЁрЄюЁр"""
        # ╤эрўрыр ЁхушёЄЁшЁєхь рфьшэшёЄЁрЄюЁр
        register_url = f"{base_url}{api_path}/admin/register"
        requests.post(register_url, json=valid_admin_data)
    
        # ┬√яюыэ хь тїюф
        login_url = f"{base_url}{api_path}/admin/login"
        response = requests.post(login_url, json=admin_login_data)
    
>       assert response.status_code == 200
E       assert 401 == 200
E        +  where 401 = <Response [401]>.status_code

tests\services\auth\test_auth_endpoints.py:323: AssertionError
________________ TestAdminRegister.test_admin_register_success ________________

self = <tests.services.auth.test_auth_endpoints.TestAdminRegister object at 0x0000016F63B4ACF0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_admin_data = {'login': 'testadmin1764503709245@example.com', 'password': 'AdminSecurePassword123'}

    def test_admin_register_success(self, base_url, api_path, valid_admin_data):
        """╙ёях°эр  ЁхушёЄЁрЎш  рфьшэшёЄЁрЄюЁр"""
        url = f"{base_url}{api_path}/admin/register"
        response = requests.post(url, json=valid_admin_data)
    
>       assert response.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500]>.status_code

tests\services\auth\test_auth_endpoints.py:381: AssertionError
____________ TestAdminRegister.test_admin_register_duplicate_login ____________

self = <tests.services.auth.test_auth_endpoints.TestAdminRegister object at 0x0000016F63B4AF00>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_admin_data = {'login': 'testadmin1764503709477@example.com', 'password': 'AdminSecurePassword123'}

    def test_admin_register_duplicate_login(self, base_url, api_path, valid_admin_data):
        """╨хушёЄЁрЎш  рфьшэшёЄЁрЄюЁр ё єцх ёє∙хёЄтє■∙шь login фюыцэр тхЁэєЄ№ 409"""
        # ╤эрўрыр ЁхушёЄЁшЁєхь рфьшэшёЄЁрЄюЁр
        url = f"{base_url}{api_path}/admin/register"
        first_response = requests.post(url, json=valid_admin_data)
>       assert first_response.status_code == 201  # ╙схцфрхьё , ўЄю яхЁтр  ЁхушёЄЁрЎш  єёях°эр
E       assert 500 == 201
E        +  where 500 = <Response [500]>.status_code

tests\services\auth\test_auth_endpoints.py:394: AssertionError
______ TestAdminRegister.test_admin_register_invalid_password_too_short _______

self = <tests.services.auth.test_auth_endpoints.TestAdminRegister object at 0x0000016F63B4B0E0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
unique_timestamp = 1764503709702

    def test_admin_register_invalid_password_too_short(self, base_url, api_path, unique_timestamp):
        """╨хушёЄЁрЎш  рфьшэшёЄЁрЄюЁр ё ярЁюыхь ьхэхх 8 ёшьтюыют фюыцэр тхЁэєЄ№ 400"""
        invalid_data = {
            "login": f"admin{unique_timestamp}@example.com",
            "password": "short"
        }
        url = f"{base_url}{api_path}/admin/register"
        response = requests.post(url, json=invalid_data)
    
>       assert response.status_code == 400
E       assert 500 == 400
E        +  where 500 = <Response [500]>.status_code

tests\services\auth\test_auth_endpoints.py:413: AssertionError
___________________ TestValidateToken.test_validate_success ___________________

self = <tests.services.auth.test_auth_endpoints.TestValidateToken object at 0x0000016F63B4B4A0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503709930@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503709930@example.com', 'password': 'SecurePassword123'}

    def test_validate_success(self, base_url, api_path, valid_user_data, login_data):
        """╙ёях°эр  трышфрЎш  Єюъхэр"""
        # ╨хушёЄЁшЁєхь ш тїюфшь
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        login_url = f"{base_url}{api_path}/login"
        login_response = requests.post(login_url, json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\auth\test_auth_endpoints.py:438: KeyError
_________________ TestValidateToken.test_validate_admin_token _________________

self = <tests.services.auth.test_auth_endpoints.TestValidateToken object at 0x0000016F63B4B6E0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_admin_data = {'login': 'testadmin1764503710156@example.com', 'password': 'AdminSecurePassword123'}
admin_login_data = {'login': 'testadmin1764503710156@example.com', 'password': 'AdminSecurePassword123'}

    def test_validate_admin_token(self, base_url, api_path, valid_admin_data, admin_login_data):
        """┬рышфрЎш  Єюъхэр рфьшэшёЄЁрЄюЁр"""
        # ╨хушёЄЁшЁєхь ш тїюфшь ъръ рфьшэшёЄЁрЄюЁ
        register_url = f"{base_url}{api_path}/admin/register"
        requests.post(register_url, json=valid_admin_data)
    
        login_url = f"{base_url}{api_path}/admin/login"
        login_response = requests.post(login_url, json=admin_login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\auth\test_auth_endpoints.py:463: KeyError
___________ TestValidateToken.test_validate_refresh_token_rejected ____________

self = <tests.services.auth.test_auth_endpoints.TestValidateToken object at 0x0000016F63B4B4D0>
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503710390@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503710390@example.com', 'password': 'SecurePassword123'}

    def test_validate_refresh_token_rejected(self, base_url, api_path, valid_user_data, login_data):
        """┬рышфрЎш  refresh Єюъхэр фюыцэр с√Є№ юЄъыюэхэр"""
        # ╨хушёЄЁшЁєхь ш тїюфшь
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        login_url = f"{base_url}{api_path}/login"
        login_response = requests.post(login_url, json=login_data)
>       refresh_token = login_response.json()["refresh_token"]
E       KeyError: 'refresh_token'

tests\services\auth\test_auth_endpoints.py:508: KeyError
_____________________ TestUserProfile.test_get_me_success _____________________

self = <test_user_endpoints.TestUserProfile object at 0x0000016F63BCE420>
user_service_url = 'http://localhost:8082', user_api_path = '/api/v1/users'
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503710619@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503710619@example.com', 'password': 'SecurePassword123'}

    def test_get_me_success(self, user_service_url, user_api_path, base_url, api_path, valid_user_data, login_data):
        """╧юыєўхэшх ётюхую яЁюЇшы """
        # ╨хушёЄЁшЁєхь ш тїюфшь
        register_url = f"{base_url}{api_path}/register"
        requests.post(register_url, json=valid_user_data)
    
        login_url = f"{base_url}{api_path}/login"
        login_response = requests.post(login_url, json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\user\test_user_endpoints.py:29: KeyError
___________________ TestUserProfile.test_update_me_success ____________________

self = <test_user_endpoints.TestUserProfile object at 0x0000016F63BCE6C0>
user_service_url = 'http://localhost:8082', user_api_path = '/api/v1/users'
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503710851@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503710851@example.com', 'password': 'SecurePassword123'}

    def test_update_me_success(self, user_service_url, user_api_path, base_url, api_path, valid_user_data, login_data):
        """╬сэютыхэшх ётюхую яЁюЇшы """
        # ╨хушёЄЁшЁєхь ш тїюфшь
        requests.post(f"{base_url}{api_path}/register", json=valid_user_data)
        login_response = requests.post(f"{base_url}{api_path}/login", json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\user\test_user_endpoints.py:47: KeyError
_____________________ TestUserProfile.test_update_status ______________________

self = <test_user_endpoints.TestUserProfile object at 0x0000016F63BCE960>
user_service_url = 'http://localhost:8082', user_api_path = '/api/v1/users'
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503711103@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503711103@example.com', 'password': 'SecurePassword123'}

    def test_update_status(self, user_service_url, user_api_path, base_url, api_path, valid_user_data, login_data):
        """╬сэютыхэшх ёЄрЄєёр"""
        # ╨хушёЄЁшЁєхь ш тїюфшь
        requests.post(f"{base_url}{api_path}/register", json=valid_user_data)
        login_response = requests.post(f"{base_url}{api_path}/login", json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\user\test_user_endpoints.py:73: KeyError
______________________ TestUserSearch.test_search_users _______________________

self = <test_user_endpoints.TestUserSearch object at 0x0000016F63BCEC60>
user_service_url = 'http://localhost:8082', user_api_path = '/api/v1/users'
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
unique_timestamp = 1764503711327

    def test_search_users(self, user_service_url, user_api_path, base_url, api_path, unique_timestamp):
        """╧юшёъ яюы№чютрЄхыхщ"""
        # ╤ючфрхь 3 яюы№чютрЄхыхщ
        users = []
        for i in range(3):
            user_data = {
                "login": f"search_user_{i}_{unique_timestamp}@example.com",
                "password": "Password123",
                "surname": f"SearchSurname{unique_timestamp}",
                "name": f"SearchName{i}",
            }
            requests.post(f"{base_url}{api_path}/register", json=user_data)
            users.append(user_data)
    
        # ┬їюфшь яхЁт√ь яюы№чютрЄхыхь фы  яюшёър
        login_data = {"login": users[0]["login"], "password": users[0]["password"]}
        login_response = requests.post(f"{base_url}{api_path}/login", json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\user\test_user_endpoints.py:113: KeyError
_________________ TestWorkspaceUsers.test_get_workspace_users _________________

self = <test_user_endpoints.TestWorkspaceUsers object at 0x0000016F63BCE990>
user_service_url = 'http://localhost:8082', user_api_path = '/api/v1/users'
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503712027@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503712027@example.com', 'password': 'SecurePassword123'}
db_cursor = <cursor object at 0x0000016F63BBCAA0; closed: 0>
clean_workspace_data = None

    def test_get_workspace_users(self, user_service_url, user_api_path, base_url, api_path, valid_user_data, login_data, db_cursor, clean_workspace_data):
        """╧юыєўхэшх яюы№чютрЄхыхщ Ёрсюўхую яЁюёЄЁрэёЄтр"""
        # 1. ╨хушёЄЁшЁєхь яюы№чютрЄхы 
        requests.post(f"{base_url}{api_path}/register", json=valid_user_data)
        login_response = requests.post(f"{base_url}{api_path}/login", json=login_data)
>       access_token = login_response.json()["access_token"]
E       KeyError: 'access_token'

tests\services\user\test_user_endpoints.py:137: KeyError
____________ TestWorkspaceUsers.test_get_workspace_users_forbidden ____________

self = <test_user_endpoints.TestWorkspaceUsers object at 0x0000016F63BCE540>
user_service_url = 'http://localhost:8082', user_api_path = '/api/v1/users'
base_url = 'http://localhost:8081', api_path = '/api/v1/auth'
valid_user_data = {'login': 'testuser1764503712273@example.com', 'name': 'Ivan', 'password': 'SecurePassword123', 'patronymic': 'Ivanovich', ...}
login_data = {'login': 'testuser1764503712273@example.com', 'password': 'SecurePassword123'}
db_cursor = <cursor object at 0x0000016F63BBD220; closed: 0>
clean_workspace_data = None

    def test_get_workspace_users_forbidden(self, user_service_url, user_api_path, base_url, api_path, valid_user_data, login_data, db_cursor, clean_workspace_data):
        """╧юя√Єър яюыєўшЄ№ яюы№чютрЄхыхщ ўєцюую ╨╧"""
        # 1. ╨хушёЄЁшЁєхь яюы№чютрЄхы  1 (┬ырфхыхЎ ╨╧)
        requests.post(f"{base_url}{api_path}/register", json=valid_user_data)
        login_response = requests.post(f"{base_url}{api_path}/login", json=login_data)
>       user1_id = login_response.json()["user"]["id"]
E       KeyError: 'user'

tests\services\user\test_user_endpoints.py:178: KeyError
=========================== short test summary info ===========================
FAILED tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_success
FAILED tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_duplicate_login
FAILED tests/services/auth/test_auth_endpoints.py::TestUserRegister::test_register_without_patronymic
FAILED tests/services/auth/test_auth_endpoints.py::TestUserLogin::test_login_success
FAILED tests/services/auth/test_auth_endpoints.py::TestRefreshToken::test_refresh_success
FAILED tests/services/auth/test_auth_endpoints.py::TestRefreshToken::test_refresh_revoked_token
FAILED tests/services/auth/test_auth_endpoints.py::TestLogout::test_logout_success
FAILED tests/services/auth/test_auth_endpoints.py::TestAdminLogin::test_admin_login_success
FAILED tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_success
FAILED tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_duplicate_login
FAILED tests/services/auth/test_auth_endpoints.py::TestAdminRegister::test_admin_register_invalid_password_too_short
FAILED tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_success
FAILED tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_admin_token
FAILED tests/services/auth/test_auth_endpoints.py::TestValidateToken::test_validate_refresh_token_rejected
FAILED tests/services/user/test_user_endpoints.py::TestUserProfile::test_get_me_success
FAILED tests/services/user/test_user_endpoints.py::TestUserProfile::test_update_me_success
FAILED tests/services/user/test_user_endpoints.py::TestUserProfile::test_update_status
FAILED tests/services/user/test_user_endpoints.py::TestUserSearch::test_search_users
FAILED tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users
FAILED tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users_forbidden
ERROR tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users
ERROR tests/services/user/test_user_endpoints.py::TestWorkspaceUsers::test_get_workspace_users_forbidden
=================== 20 failed, 19 passed, 2 errors in 5.79s ===================
