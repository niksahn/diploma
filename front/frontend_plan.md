# План фронтенда для корпоративного мессенджера (клиент к Gateway)

## Цели и предпосылки
- Фронт обращается только к `api-gateway` (REST + WebSocket), без прямых вызовов других сервисов.
- Поддерживаем роли обычного пользователя и руководителя рабочего пространства; административная панель вне рамок.
- Минимум зависимостей, быстрый запуск для локальной разработки.

## Страницы и что на них должно быть

### 1. Аутентификация (login/registration)
- Поля: логин, пароль; опционально повтор пароля для регистрации.
- Действия: вход, переход на регистрацию, выход (очистка токена), восстановление сессии по сохранённому токену.
- UI: компактная форма, ошибки валидации, лоадер при запросе.
- API: `POST /auth/register`, `POST /auth/login` (через gateway), хранение JWT.

### 2. Выбор рабочего пространства
- Список рабочих пространств пользователя (роль, дата приглашения).
- Действия: перейти в выбранное РП, выйти из РП (если поддерживается API), создать РП (для руководителя).
- UI: карточки/таблица с названием, создателем, тарифом; быстрый поиск.
- API: `GET /workspaces`, `POST /workspaces`, `POST /workspaces/{id}/exit` (или аналог).

### 3. Главный каркас (layout)
- Левое меню: переключение РП, Чаты, Задачи, Жалобы, Профиль.
- Верхняя панель: текущий пользователь, статус, кнопка выхода, индикатор подключения WebSocket.
- Глобальные состояния: спиннер фоновых запросов, тосты ошибок/успехов.

### 4. Чаты (список)
- Список чатов в выбранном РП: название, тип (групповой/личный), непрочитанные, последняя активность.
- Действия: создать чат (имя, тип, участники), поиск по названию, сортировка.
- API: `GET /chats?workspaceId=`, `POST /chats`.

### 5. Чат (просмотр)
- Поток сообщений с виртуализацией; инпут отправки текста; кнопка отправки.
- Показ автора, времени, статуса доставки; группировка по дате.
- Боковая панель: участники, их роли; быстрый переход к связанным задачам (если есть).
- Действия: отправить сообщение, отметить прочитанным (при открытии), подключение по WebSocket для live-обновлений, загрузка истории пагинацией.
- API/WS: `GET /chats/{id}/messages`, `POST /chats/{id}/messages`; WebSocket subscribe `/ws/chats/{id}` (через gateway).

### 6. Задачи (список)
- Таблица/доска задач в РП: заголовок, исполнитель(и), статус, срок/дата, чат-привязка.
- Фильтры: по статусу, назначенным на меня, по чату.
- Действия: создать задачу (заголовок, описание, исполнители, чат), сменить статус, быстрые действия “в работу/готово”.
- API: `GET /tasks?workspaceId=`, `POST /tasks`, `PATCH /tasks/{id}` (статус/поля).

### 7. Карточка задачи
- Детали: описание, статус, исполнитель(и), история изменений, связанный чат.
- Действия: редактировать поля, добавить/убрать исполнителей, просмотреть историю, перейти в чат.
- API: `GET /tasks/{id}`, `PATCH /tasks/{id}`, `GET /tasks/{id}/changes`, `POST /tasks/{id}/users`.

### 8. Управление участниками РП (для руководителя)
- Список участников: ФИО/логин, роль в РП, дата добавления.
- Действия: пригласить пользователя по логину/ид, сменить роль, удалить из РП.
- API: `GET /workspaces/{id}/users`, `POST /workspaces/{id}/users`, `PATCH /workspaces/{id}/users/{userId}`, `DELETE ...`.

### 9. Жалобы (support)
- Форма создания жалобы: текст, опционально описание устройства.
- Список отправленных жалоб пользователя: дата, статус.
- API: `POST /complaints`, `GET /complaints/my`.

### 10. Профиль пользователя
- Отображение ФИО, логина, статуса.
- Действия: смена статуса/аватара (если есть), просмотр своих ролей в РП.
- API: `GET /users/me`, `PATCH /users/me`.

### 11. Системные страницы
- 404/Not found, 500/Fallback, экран “нет доступа”.
- Экран “нет выбранного РП” с ссылкой на список РП.

## Техническое решение (простое и легко запускается)
- Стек: Vite + React + TypeScript; UI: Tailwind CSS + Headless UI; роутинг: React Router v6; данные: TanStack Query для кеша и фонового обновления; лёгкое состояние UI: Zustand.
- Сетевой слой: `fetch`-клиент с базовым URL из `.env` (`VITE_API_BASE_URL`), автоматическая подстановка JWT, перехват 401 → логаут.
- WebSocket: лёгкий клиент с авто‑reconnect (exponential backoff); отдельный hook `useChatSocket(chatId)` для подписки на входящие сообщения.
- Хранение сессии: JWT в `localStorage`, данные профиля в React Query cache; защита роутов (private routes).
- Сборка/запуск: `npm install`; `npm run dev` (vite dev server); `npm run build && npm run preview` для прод-стенда.
- Структура: `src/app` (router/layout), `src/entities` (user, workspace, chat, task), `src/features` (auth, send-message, change-status), `src/pages` (route-level), `src/shared` (ui, lib, api).
- Тесты (базово): vitest + React Testing Library для критичных hooks и компонентов; линт: eslint + prettier (ready-to-run).

## Минимальные пользовательские потоки (MVP с приоритетом)
- Войти → выбрать РП → открыть чат → отправить сообщение (live).
- Войти → выбрать РП → создать задачу → сменить статус → увидеть в списке.
- Создать жалобу → увидеть её в списке отправленных.

