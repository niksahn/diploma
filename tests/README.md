# Тесты для корпоративного мессенджера

Этот каталог содержит функциональные (интеграционные) тесты для всех микросервисов системы.

## Структура

```
tests/
├── conftest.py              # Общие фикстуры и настройки
├── requirements.txt        # Зависимости для тестов
├── services/
│   ├── auth/
│   │   └── test_auth_endpoints.py  # Тесты для Auth Service
│   └── ...
└── README.md               # Этот файл
```

## Установка зависимостей

```bash
pip install -r requirements.txt
```

## Запуск тестов

### Все тесты

```bash
pytest
```

### Тесты для конкретного сервиса

```bash
# Тесты Auth Service
pytest tests/services/auth/
```

### Тесты с подробным выводом

```bash
pytest -v
```

### Тесты с выводом print-ов

```bash
pytest -s
```

## Переменные окружения

По умолчанию тесты используют следующие настройки:

- `AUTH_SERVICE_URL=http://localhost:8081` - URL для Auth Service

Вы можете переопределить их через переменные окружения:

```bash
export AUTH_SERVICE_URL=http://localhost:8081
pytest tests/services/auth/
```

## Требования

Перед запуском тестов убедитесь, что:

1. Все микросервисы запущены и доступны
2. База данных настроена и доступна
3. Все необходимые миграции применены

## Покрытие эндпоинтов

### Auth Service

Тесты покрывают все эндпоинты из `server/plans/api/auth_service.md`:

- ✅ `POST /api/v1/auth/register` - регистрация пользователя
- ✅ `POST /api/v1/auth/login` - вход пользователя
- ✅ `POST /api/v1/auth/refresh` - обновление токена
- ✅ `POST /api/v1/auth/logout` - выход из системы
- ✅ `POST /api/v1/auth/admin/login` - вход администратора
- ✅ `POST /api/v1/auth/admin/register` - регистрация администратора
- ✅ `POST /api/v1/auth/validate` - валидация токена

Для каждого эндпоинта тестируются:
- Успешные сценарии (happy path)
- Обработка ошибок валидации (400)
- Обработка ошибок авторизации (401)
- Обработка конфликтов (409)
- Валидация входных данных






























