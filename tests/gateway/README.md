# Gateway сценарные тесты

Набор функциональных тестов покрывает ключевые пользовательские сценарии корпоративного мессенджера через API Gateway (`server/plans/api/gateway.md`, схемы в `server/src/swagger-docs`).

## Покрываемые сценарии
- **Аутентификация и профиль**
  - Регистрация пользователя через Gateway.
  - Логин и получение пары токенов.
  - Обновление access-токена по refresh.
  - Запрос агрегированного профиля `/api/v1/gateway/me`.
  - Выход из системы.

- **Рабочие пространства и чаты**
  - Администратор создаёт тариф.
  - Администратор создаёт рабочее пространство и назначает лидера.
  - Лидер приглашает участника.
  - Участник получает список доступных рабочих пространств.
  - Лидер создаёт групповой чат в РП.
  - Участник отправляет сообщение, лидер читает историю сообщений.

- **Задачи и жалобы**
  - Лидер создаёт задачу в выбранном РП и назначает исполнителя.
  - Лидер обновляет статус задачи.
  - Лидер привязывает задачу к чату.
  - Исполнитель запрашивает список задач своего РП.
  - Исполнитель отправляет жалобу, просматривает список собственных жалоб.

## Дополнительные сценарии (из usecase_messendger)
- **Навигация по рабочему пространству**
  - Пользователь выбирает рабочее пространство, выходит из него.
  - Руководитель изменяет параметры РП и передаёт лидерство другому пользователю.
  - Управление тарифом РП (просмотр/создание/обновление тарифов).

- **Участники РП**
  - Руководитель добавляет/редактирует/удаляет пользователей в РП с ролями.
  - Проверка доступа участника к РП, отказ для посторонних.

- **Чаты и сообщения**
  - Создание личных, групповых чатов и каналов.
  - Управление участниками чата (добавление, изменение роли, удаление).
  - CRUD сообщений: отправка, получение истории, редактирование, удаление.
  - Отметка сообщений как прочитанных.

- **Задачи**
  - Создание задачи, обновление описания/даты/статуса.
  - Назначение и удаление исполнителей.
  - История изменений задачи.
  - Привязка/отвязка задач к чатам.

- **Жалобы**
  - Пользователь создаёт жалобу, смотрит свои жалобы.
  - Администратор просматривает, меняет статус, удаляет жалобу.

- **Общие проверки доступа**
  - Публичные маршруты (health, публичные auth) не требуют токена.
  - Защищённые маршруты отклоняют без токена и при недостатке ролей.

## Запуск
```
pytest tests/gateway -v
```

