@startuml
skinparam componentStyle uml2
skinparam backgroundColor white
skinparam linetype ortho  

title Диаграмма компонентов - Корпоративный Мессенджер

actor "Пользователь" as UserActor

package "Клиентская часть (Frontend)" {
    component "Мессенджер\n(Веб/Десктоп Клиент)" as ClientApp
}

package "Серверная часть (Backend)" {
    component "API Gateway" as APIGateway
    
    package "Слой Бизнес-логики (Services)" {
        component "Сервис Аутентификации\n(Auth Service)" as AuthService
        component "Сервис Пользователей\n(User Service)" as UserService
        component "Сервис Рабочих пространств\n(Workspace Service)" as WorkspaceService
        component "Сервис Чатов и Сообщений\n(Chat & Message Service)" as ChatService
        component "Сервис Задач\n(Task Service)" as TaskService
        component "Сервис Жалоб\n(Complaint Service)" as ComplaintService

    }
    }

database "Kafka" as Kafka
database "База Данных\n(PostgreSQL)" as DB

' Связи актеров с интерфейсами
UserActor ..> ClientApp 
' Связи интерфейсов с API
ClientApp --> APIGateway
' Маршрутизация запросов от Gateway к сервисам
APIGateway --> AuthService 
APIGateway --> UserService 
APIGateway --> WorkspaceService
APIGateway --> ChatService 
APIGateway --> TaskService 
APIGateway --> ComplaintService


' Взаимосвязи между компонентами

WorkspaceService ..> UserService 

ChatService ..> WorkspaceService 
ChatService ..> UserService 

TaskService ..> WorkspaceService 
TaskService ..> UserService 
TaskService ..> ChatService

ComplaintService ..> UserService 

' Доступ к данным
AuthService ..> DB
UserService ..> DB
WorkspaceService ..> DB
ChatService ..> DB
TaskService ..> DB
ComplaintService ..> DB

ComplaintService ..> Kafka
Kafka ..> UserService

@enduml